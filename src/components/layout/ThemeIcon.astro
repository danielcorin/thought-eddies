---
import { Icon } from "astro-icon/components";
---

<script>
    const themeToggle = document.getElementById("theme-toggle");
    const sunWrapper = document.querySelector(".sun-wrapper");
    const moonWrapper = document.querySelector(".moon-wrapper");

    const updateTheme = (isDark: boolean) => {
        document.documentElement.classList.toggle("dark", isDark);
        document.documentElement.classList.toggle("light", !isDark);
        localStorage.setItem("theme", isDark ? "dark" : "light");
        sunWrapper?.classList.toggle("hidden", isDark);
        moonWrapper?.classList.toggle("hidden", !isDark);

        // Dispatch custom event for other components to listen to
        window.dispatchEvent(
            new CustomEvent("themeChanged", {
                detail: { isDark },
            }),
        );
    };

    // Initialize the toggle button state based on current theme
    const initializeTheme = () => {
        const isDark = document.documentElement.classList.contains("dark");
        sunWrapper?.classList.toggle("hidden", isDark);
        moonWrapper?.classList.toggle("hidden", !isDark);
    };

    // Run initialization
    initializeTheme();

    themeToggle?.addEventListener("click", () => {
        const isDark = document.documentElement.classList.contains("dark");
        updateTheme(!isDark);
    });
</script>

<button id="theme-toggle" class="nav-link ml-auto">
    <span class="nav-item">
        <span class="sun-wrapper">
            <Icon name="ph:sun" class="inline-icon" />
        </span>
        <span class="moon-wrapper hidden">
            <Icon name="ph:moon" class="inline-icon" />
        </span>
    </span>
</button>
